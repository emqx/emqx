Fixed timestamp ordering issue where `disconnected_at` could be later than `connected_at` during session takeover or discard scenarios.

Previously, `disconnected_at` was recorded too late (in `ensure_disconnected`), after the new session's `connected_at` was already set. This caused a race condition where `disconnected_at > connected_at`, making it difficult to track client presence state externally.

The fix records `disconnected_at` immediately when takeover begins or when discard is received, ensuring it's no later than the new session's `connected_at`. This ensures correct timestamp ordering for external presence state tracking systems.

Note: when these events are emitted from different cluster nodes, the observed ordering also depends on inter-node clock synchronization.
